<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Alan Lawrey is a software developer in Melbourne Australia."><meta property=og:type content=website><meta property=og:url content=https://astrellon.github.io/ ><meta property=og:title content="Alan Lawrey"><meta property=og:description content="Alan Lawrey is a software developer in Melbourne Australia."><meta property=og:image content=https://astrellon.github.io/alanlawrey.newbest.jpg><meta name=twitter:card content=summary><meta name=twitter:domain value=astrellon.github.io><meta name=twitter:creator value=@Alan_Lawrey><meta name=twitter:title value="Alan Lawrey"><meta name=twitter:description value="Alan Lawrey is a software developer in Melbourne Australia."><meta name=twitter:image content=https://astrellon.github.io/alanlawrey.newbest.jpg><meta name=theme-color content=#222222><link rel=icon href=./favicon.ico type=image/x-icon><title>Alan Lawrey</title><style>*{box-sizing:border-box}html{background-color:#202020;color:#eee;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif}body{margin:0 auto;display:flex;flex-direction:column}body,html{width:100%;height:100%}header{height:20rem}footer{color:#444;text-shadow:0 2px 2px rgba(0,0,0,.2)}a{color:#69e;white-space:pre;transition:color .15s ease-in-out}a:hover{color:#7af}a:visited{color:#a9d}a:visited:hover{color:#bae}.background{position:relative;height:100%;width:100%;background:url("./images/gradientWide.png"),#fff;background-size:10000px 100%;animation:background-scrolling 60s linear infinite}.background h1{color:#222}h1,h2{text-shadow:0 2px 2px rgba(0,0,0,.2)}.zigzag{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABACAYAAABcIPRGAAAAAXNSR0IArs4c6QAAATtJREFUaIHtk1sOgyAQRYUduAOX1+6oqzRxBfTLBimX1zCgyT1/DgLnmNZs2+aWB2NnC0hhwGwYMBsGzIYBs2FAjuM4VM9XDTjlNSPUAkJprQiVACSrEdE9IJTc9/2dWpfSNQDJa0Z0C8h9ea2ILgE5eTTvESEOyMkbYz6pdWmEKKBUXjOiOaD2y2tFNAXUyqN5j4jqgFZ5tC6NqAqQyqP3JBHFAb3k0futEUUBveXRvpaIbICWPNpfG5EM0JZH59REwIBR8ui80ohowGh5dG5JxF/ALHl0fi7CphZHy6N7UhE2NoxtGiWP7kMR1n9AL4+WR/fGIuxd5dH9oZ9NLc6WP0lF2Ngwtmk2KMKs6+ruLu/jnHv5z+ZvcGP5E9/58h94gvyyXD1tbPgEfr7hT4gQQgghhBBCCCFkCF8qw0VJg13K8wAAAABJRU5ErkJggg==") repeat-x;background-size:12px;height:16px;display:block;position:absolute;left:0;right:0}.zigzag.top{top:0}.zigzag.bottom{bottom:0;margin-bottom:-1px;transform:scaleY(-1);background-position-x:6px}.separator{display:block;height:4rem}.small-separator{display:block;height:1.5rem;margin:1rem 0}.container{margin:0 auto;padding:2rem;font-size:125%;flex:auto;max-width:960px}.image-container img{box-shadow:0 2px 10px #000;transition:box-shadow .15s ease-in-out,transform .15s ease-in-out}.image-container img:hover{box-shadow:0 4px 40px #111;transform:translateY(-2px)}.header-container{display:flex;justify-content:space-between;padding-bottom:2.5rem}.heading{font-size:200%;font-weight:700;margin:0;align-self:center}.photo-frame{perspective:600px;width:96px;height:96px;display:block}.photo-frame:hover .photo{transform:rotateY(180deg)}.photo{width:100%;height:100%;position:relative;transition:transform .3s ease-in-out;transform-style:preserve-3d}.photo>img{width:100%;height:100%;border:1px solid #333;border-radius:50%;position:absolute;top:0;right:0;backface-visibility:hidden;box-shadow:0 2px 10px #000;border-radius:1rem}.photo__back{transform:rotateY(180deg)}.project__title{font-size:125%;font-weight:700;margin:1.25rem 0;text-shadow:0 3px 3px rgba(0,0,0,.5)}.project__period{display:inline-block;color:#999;font-size:60%;font-weight:400}.project__link{display:inline-block;font-size:60%}.project__desc{flex:1.5}.project__pic{flex:1;margin-left:12px}.project__pic>*{margin-bottom:6px;display:table;width:100%}.project__pic img{max-width:350px;width:100%;overflow:hidden}.project__contents{display:flex;justify-content:space-between;flex-flow:wrap}.code{background-color:#333;padding:6px;box-shadow:0 2px 10px #000;border:1px solid #000}@media only screen and (max-width:380px){pre{font-size:75%}header{padding:2rem 0}footer{padding:1.1rem 0}.container{padding:5px 10px;margin:0 10px}.heading{line-height:96px;font-size:150%}.photo-frame{width:96px;height:96px}}@media only screen and (max-width:960px){.project__contents{flex-flow:column}.project__pic{flex:1;margin-left:0}.project__pic img{max-width:unset}}@keyframes background-scrolling{0%{background-position-x:0px}100%{background-position-x:10000px}}</style><header class=background><div class="container header-container"><aside class=photo-frame><div class=photo><img class=photo__front src=./images/alanlawrey.jpg alt="A photo of my face at Osaka Castle."> <img class=photo__back src=./images/alanlawrey.newbest.jpg alt="Another photo of my face at the Sapporo Snow Festival."></div></aside><h1 class=heading>Alan Lawrey</h1></div><div class="zigzag bottom"></div></header><main><canvas id=ripplesCanvas></canvas><article class=container><h2>Overview</h2><section><p>I'm a software developer from Melbourne Australia. I've previously worked at <a href=https://www.migenius.com/ >migenius</a>, <a href=https://rome2rio.com>Rome2rio</a> and <a href=https://metrotrains.com.au>Metro Trains Melbourne</a>.<p>You can contact me via <a href=mailto:alan.lawrey@gmail.com>email</a> or find me on <a href=https://twitter.com/Alan_Lawrey>Twitter</a> or <a href=https://www.linkedin.com/in/alan-lawrey-b7509b21/ >LinkedIn</a>.<p>What I enjoy working on:<ul><li>Creating websites with an emphasis on single page applications.<li>Creating tooling for workflows.<li>Webservice APIs.<li>Real time web servers for games.<li>Mentoring about software development.<li>Creating cross platform games. <a href=https://astrellon.itch.io/ >I have a small itch.io page.</a><li>Simple artwork <a href=https://www.instagram.com/astrellon_art/ >Instagram</a>, <a href=https://www.redbubble.com/people/astrellon>Redbubble</a>, <a href=https://teepublic.com/user/astrellonart>TeePublic</a> and <a href=https://society6.com/astrellon_art>Society6</a>.</ul><p></section></article><div class="background separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><article class=image-container><div class=container><h2>Previous Work</h2><section><div class=project__title>Metro Trains Melbourne <span class=project__period>SEP 2018 - AUG 2019</span></div><div class=project__contents><section class=project__desc><p>Metro Trains Melbourne needed a tool for monitoring real time voltages and currents for testing their new trains.<p>This work combined hardware installed in the field (created by my co-worker) and a server with a front end (created by me).<p>The hardware was made up of an industrial PC with a USB oscilloscope and 4G modem.<p>I worked on:<ul><li>Creating a backend in .Net Core that received the data.<li>Creating the frontend for use on a PC or mobile, built using Typescript and React.<li>Handling displaying live data of up to 120k samples on a mobile device.<li>Storing, retrieving and processes all the data, which ranged between 40k samples per second to 120k samples per second.<li>Utilising various Amazon Web Services such as EC2 to host the server, RDS to host the database for users and config, S3 for long term storage of raw data and SQS as a backup connection should the server go down.</ul><p></section><aside class=project__pic><a href=./images/mtmGraphs.png target=_blank><img src=./images/mtmGraphs_small.jpg loading=lazy alt="An example of live data from field units being displayed on a web UI."></a><a href=./images/mtmDataLookup.png target=_blank><img src=./images/mtmDataLookup_small.jpg loading=lazy alt="An example of the data lookup UI for retrieving old data."></a><a href=./images/mtmDataLookup2.jpg target=_blank><img src=./images/mtmDataLookup2_small.jpg loading=lazy alt="An example of old data that has ben looked up."></a></aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>Rome2rio <span class=project__period>OCT 2014 - JUL 2018</span></div><div class=project__contents><section class=project__desc><p>Rome2rio is a travel search website used for finding and comparing different routes from anywhere in the world. It specialised in ground transport.<p>I worked on:<ul><li>Adding schedule information and the ability to buy tickets directly through Rome2rio for UK trains.<li>Internal tools for modifying their data through a web UI (not pictured).<li>Expanding upon and improved the infrastructure of their tooling.<li>For two years I mentored someone which resulted in them being able to shift from a non-dev role into a junior software dev.</ul><p></section><aside class=project__pic><a href=./images/rome2rioTickets.png target=_blank><img src=./images/rome2rioTickets_small.png loading=lazy alt="An example of buying a train ticket in the UK directly with Rome2rio"></a><a href=./images/rome2rioSchedules.png target=_blank><img src=./images/rome2rioSchedules.png loading=lazy alt="An example of a train timetable in Melbourne."></a></aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>migenius and mental images <span class=project__period>JAN 2008 - OCT 2014</span></div><div class=project__contents><section class=project__desc><p>mental images are a company that specialises in photographic rendering using ray and path tracing software. After 3 years the Melbourne office split off to form the company migenius which continued to do the same work and allowed for working on stand alone products. Bloom Unit was their first product and combined the ease of using SketchUp's 3d editing with real time photographic images.<br>I worked on:<ul><li>The interface between SketchUp (ruby) and Bloom Unit (C++) for keeping the 3d scene in sync.<li>The UI (Internet Explorer 6) for adjusting the render settings and configuring the materials.</ul><p><p>We also worked on other projects for various clients:<ul><li>Integrating Bloom Unit into Autodesk Revit for Oldcastle.<li>Web visualisation projects for Obayashi Corporation and Shimizu Corporation.<li>A product visualiser for Takemoto products. <a href="http://www3d1.takemotokk.co.jp/takemoto/?lang=en">Bottle 3d Visualiser</a><li>A product visualiser for Christ Jewellery. <a href=https://www.christ.de/ >Ring Configurator</a></ul><p></section><aside class=project__pic><a href=./images/bloomunit.jpg target=_blank><img src=./images/bloomunit_small.jpg loading=lazy alt="A screenshot of SketchUp with Bloom Unit running."></a><a href=./images/takemoto.jpg target=_blank><img src=./images/takemoto_small.jpg loading=lazy alt="A screenshot of Takemoto's 3d Visualizer being used."></a><a href=./images/christRingConfigurator.jpg target=_blank><img src=./images/christRingConfigurator_small.jpg loading=lazy alt="A screenshot of Christ Ring Configurator being used."></a></aside></div></section></div></article><div class="background separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><article class=image-container><div class=container><h2>Personal Projects</h2><section><div class=project__title>Pirate blockbreak clone <a class=project__link href=https://astrellon.itch.io/pirating>itch.io Link</a></div><div class=project__contents><section class=project__desc><p>A one week project to build something from scratch and release it somewhere. Fairly basic blockbreak clone with a bit of a twist.<p>Main features:<ul><li>Shoot cannonballs to break blocks, but don't let them hit you.<li>Stores high score locally.<li>Optional Slack support for posting scores.<li>Cross platform for Linux, OSX and Windows.</ul><p></section><aside class=project__pic><a href=./images/pirating.jpg target=_blank><img src=./images/pirating_small.jpg loading=lazy alt="A screenshot of a pirate themed block break game."></a></aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>LOSS (Lua Operating SyStem) <a class=project__link href=https://github.com/astrellon/loss>Github Link</a></div><div class=project__contents><section class=project__desc><p>A project to create an operating system that's built around using Lua with the intention of being light weight. The main use case was for a game where you may want many simple in-game operating systems that look like a *NIX shell but without actually running a VM.<p>Main features:<ul><li>A modified version of the Lua VM that supports running multiple Lua States in the same thread using Boost Coroutines<li>A virtual file system the supports mounting different types of file systems.<li>A RAMFS for virtual files (such as /dev and /proc)<li>A persistent file system for long term storage.<li>A Fuse implementation that allows for mounting the persistent hard drives and modifying them outside of the VM.</ul><p></section><aside class=project__pic><pre class=code>
  [ SUCCESS ] Setup VFS
  [ SUCCESS ] Created root user
  [ SUCCESS ] Created kernel process
  [ SUCCESS ] Created proc filesystem
  Booting system from init.d

  Lua worked
  Ending process: lua: 4
  Reading /greetings.txt
  Line! 1: Hello There
  Line! 2: How are you?
  Line! 3:
  Line! 4: What is up?

  Lua worked
  Ending process: lua: 4
            </pre>An example of starting the VM with an init.d file that just prints some text.</aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>LOSS v0 <a class=project__link href=https://github.com/astrellon/ScalingOctoDubstep>Github Link</a></div><div class=project__contents><section class=project__desc><p>An earlier attempt at creating an OS for use in a game, specifically for a space game. This was a relatively naive approach that used NLua which is a C# implementation of Lua for use in Unity.<p>Main features:<ul><li>Basic shell for running Lua.<li>A simple VT100 terminal emulator that used built in Unity components for text rendering.<li>A very simple file system, however it did not support mounting.</ul><p></section><aside class=project__pic><a href=./images/scalingOctoDubstep.png target=_blank><img src=./images/scalingOctoDubstep_small.jpg loading=lazy alt="A screenshot of the ScalingOctoDubstep UI in Unity."></a></aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>Voxel Engine <a class=project__link href=https://github.com/astrellon/mm>Github Link</a></div><div class=project__contents><section class=project__desc><p>A small voxel engine aim at being able to create and edit levels entirely within Unity. It performed well enough for the scale of the levels I wanted to created, however getting the editor tools to behave the way I wanted proved to be the most tricky aspect.<p>Main features:<ul><li>Chunked editing and loading. Maps are stored as individual binary files which is optimised for updating chunks during editing.<li>Multiple different shapes beyond a cube such as ramps and different corners to allow for smoother terrain.<li>Unity editing support for creating levels without needing additional tools.</ul><p></section><aside class=project__pic><a href=./images/mmVoxels.png target=_blank><img src=./images/mmVoxels_small.png loading=lazy alt="A screenshot of the Voxel Engine UI in Unity."></a></aside></div></section></div><div class="background small-separator"><div class="zigzag top"></div><div class="zigzag bottom"></div></div><div class=container><section><div class=project__title>RPG Game <a class=project__link href=https://github.com/astrellon/Rouge>Github Link</a></div><div class=project__contents><section class=project__desc><p>A topdown 2D RPG game engine written in C++ built using minimal dependencies for the purpose of learning.<p>This is a fairly old project now, but it does represent a lot of learning in terms of C++, integrating a scripting language, handling modding, dealing with complex UI and handling an audio system.<p>Main features:<ul><li>Tile based 2D graphics with a tile overlapping system for blending between tiles.<li>Sound system that supports streaming OGG and WAV files.<li>Lua Bindings for controlling just about every aspect of the game. From how a new game is created and loaded to how a door should behave when interacted with.<li>Maps are created through Lua and has a mechanism for determining if the map is being played new or loaded from disk, allowing for map scripts to upgrade old save files.<li>A dialogue system based on The Elder Scrolls: Morrowind with topics, keywords and actions bound to those keywords.<li>HTML documentation taken from the C++ comments using a Python script.<li>In game text uses a simplistic CSS and HTML system for rich text.<li>An in game map editor for creating new levels.</ul><p></section><aside class=project__pic><a href=./images/rouge.png target=_blank><img src=./images/rouge.png loading=lazy alt="A screenshot of the RPG game engine."></a><a href=./images/rougeMapEditor.png target=_blank><img src=./images/rougeMapEditor.png loading=lazy alt="A screenshot of the in game map editor."></a></aside></div></section></div></article></main><footer class=background><div class="zigzag top"></div><div class=container>Alan Lawrey 2024</div></footer><script>class WebGlConfig{constructor(e,r,t,o){this.extension=e,this.linearExtension=r,this.glType=t,this.arrayType=o}}function loadConfig(e){const r=e.getExtension("OES_texture_float"),t=e.getExtension("OES_texture_half_float"),o=e.getExtension("OES_texture_float_linear"),i=e.getExtension("OES_texture_half_float_linear");if(!r)return null;const n=[new WebGlConfig(r,o,e.FLOAT,Float32Array)];t&&n.push(new WebGlConfig(t,i,t.HALF_FLOAT_OES,null));const a=e.createTexture(),s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);let l=null;for(const r of n)if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,32,32,0,e.RGBA,r.glType,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE){l=r;break}return l}class BaseWebGlProgram{constructor(e,r){this.id=e,this.locations=r}}class RenderWebGlProgram extends BaseWebGlProgram{constructor(e,r){super(e,r),this.topLeft=new Float32Array(2),this.bottomRight=new Float32Array(2),this.containerRatio=new Float32Array(2),this.scroll=0}}function createProgram(e,r,t,o){function i(e,t){const o=r.createShader(e);if(!o)throw new Error("Failed to create shadow");if(r.shaderSource(o,t),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS))throw new Error("compile error: "+r.getShaderInfoLog(o));return o}const n=r.createProgram();if(!n)throw new Error("Failed to create program");if(r.attachShader(n,i(r.VERTEX_SHADER,t)),r.attachShader(n,i(r.FRAGMENT_SHADER,o)),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw new Error("link error: "+r.getProgramInfoLog(n));const a={};r.useProgram(n),r.enableVertexAttribArray(0);let s,l,h=/uniform (\w+) (\w+)/g,u=t+o;for(;null!=(s=h.exec(u));){l=s[2];const e=r.getUniformLocation(n,l);e?a[l]=e:console.warn("Failed to get location: "+l)}return new e(n,a)}function createImageData(e,r){try{return new ImageData(e,r)}catch(t){const o=document.createElement("canvas");return o?.getContext("2d")?.createImageData(e,r)}}function isPowerOf2(e){return!(e&e-1)}class Ripples{constructor(e,r=256){this.interactive=!0,this.transparentPixels=createImageData(32,32),this.textures=[],this.framebuffers=[],this.dropCircleProgram=null,this.dropBoxProgram=null,this.updateProgram=null,this.renderProgram=null,this.backgroundTexture=null,this.backgroundSize=1,this.dropRadius=12,this.perturbance=.03,this.bufferWriteIndex=0,this.bufferReadIndex=1,this.canvas=e;const t=e.getContext("webgl");if(!t)throw new Error("Unable to get webgl context");if(this.gl=t,this.resolution=r,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.config=loadConfig(t),null==this.config)throw new Error("Unable to get webgl config");const o=this.config.arrayType?new this.config.arrayType(this.resolution*this.resolution*4):null;for(let e=0;e<2;e++){const e=t.createTexture(),r=t.createFramebuffer();if(!e||!r)throw new Error("Failed to create texture/framebuffer");t.bindFramebuffer(t.FRAMEBUFFER,r),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.config.linearExtension?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.config.linearExtension?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.resolution,this.resolution,0,t.RGBA,this.config.glType,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.textures.push(e),this.framebuffers.push(r)}const i=t.createBuffer();if(!i)throw new Error("Failed to create draw quad");this.quad=i,t.bindBuffer(t.ARRAY_BUFFER,this.quad),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.setupPointerEvents(),t.clearColor(0,0,0,0),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);const n=()=>{this.step(),requestAnimationFrame(n)};requestAnimationFrame(n)}step(){this.computeTextureBoundaries(),this.update(),this.render()}loadBackground(e){const r=this.gl,t=r.RGBA,o=r.RGBA,i=r.UNSIGNED_BYTE,n=new Image;n.onload=()=>{r.bindTexture(r.TEXTURE_2D,this.backgroundTexture),r.texImage2D(r.TEXTURE_2D,0,t,o,i,n),this.backgroundSize=n.width,isPowerOf2(n.width)&&isPowerOf2(n.height)||r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)},n.onerror=e=>{console.error("Failed to load background image",e),this.setTransparentTexture()},n.src=e}setupPointerEvents(){const e=this.canvas.parentElement;e&&(e.addEventListener("mousemove",this.dropAtPointer,{passive:!0}),e.addEventListener("touchstart",this.dropAtTouch,{passive:!0}),e.addEventListener("touchmove",this.dropAtTouch,{passive:!0}))}dropAtPointer=e=>{this.interactive&&this.drop(e.clientX,e.clientY,this.dropRadius,.005)};dropAtTouch=e=>{if(!this.interactive)return;const r=e.changedTouches;for(const e of r)this.drop(e.clientX,e.clientY,this.dropRadius,.01)};dropQuad=(e,r,t,o,i)=>{if(!this.dropBoxProgram)return;const n=this.gl,a=this.canvas.width,s=this.canvas.height,l=Math.max(a,s),h=new Float32Array([(2*(e+.5*t)-a)/l*.5+.5,(s-2*(r+.5*o))/l*.5+.5]),u=new Float32Array([t/l*.5,o/l*.5]);n.viewport(0,0,this.resolution,this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),this.bindTexture(this.textures[this.bufferReadIndex]),n.useProgram(this.dropBoxProgram.id),n.uniform2fv(this.dropBoxProgram.locations.center,h),n.uniform2fv(this.dropBoxProgram.locations.boxSize,u),n.uniform1f(this.dropBoxProgram.locations.strength,i),this.drawQuad(),this.swapBufferIndices()};drop(e,r,t,o){if(!this.dropCircleProgram)return;const i=this.gl,n=this.canvas.width,a=this.canvas.height,s=Math.max(n,a);t/=s;const l=new Float32Array([(2*e-n)/s*.5+.5,(a-2*r)/s*.5+.5]);i.viewport(0,0,this.resolution,this.resolution),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),this.bindTexture(this.textures[this.bufferReadIndex]),i.useProgram(this.dropCircleProgram.id),i.uniform2fv(this.dropCircleProgram.locations.center,l),i.uniform1f(this.dropCircleProgram.locations.radius,t),i.uniform1f(this.dropCircleProgram.locations.strength,o),this.drawQuad(),this.swapBufferIndices()}initShaders(){const e="attribute vec2 vertex;\nvarying vec2 coord;\nvoid main() {\n    coord = vertex * 0.5 + 0.5;\n    gl_Position = vec4(vertex, 0.0, 1.0);\n}";this.dropCircleProgram=createProgram(BaseWebGlProgram,this.gl,e,"precision highp float;\n\nconst float PI = 3.141592653589793;\nuniform sampler2D texture;\nuniform vec2 center;\nuniform float radius;\nuniform float strength;\n\nvarying vec2 coord;\n\nvoid main() {\n    vec4 info = texture2D(texture, coord);\n\n    float drop = max(0.0, 1.0 - length(center - coord) / radius);\n    drop = 0.5 - cos(drop * PI) * 0.5;\n\n    info.r += drop * strength;\n\n    gl_FragColor = info;\n}"),this.dropBoxProgram=createProgram(BaseWebGlProgram,this.gl,e,"precision highp float;\n\nuniform sampler2D texture;\nuniform vec2 center;\nuniform vec2 boxSize;\nuniform float strength;\n\nvarying vec2 coord;\n\nconst float boxRounding = 0.01;\nconst float edgeSoftness  = 0.005;\n\nfloat roundedBoxSDF(vec2 CenterPosition, vec2 Size, float Radius)\n{\n    return length(max(abs(CenterPosition)-Size+Radius,0.0))-Radius;\n}\n\nvoid main() {\n    vec4 info = texture2D(texture, coord);\n\n    float distance = roundedBoxSDF(coord - center, boxSize, boxRounding);\n    float smoothedAlpha = 1.0-smoothstep(0.0, edgeSoftness * 200.0,distance * 100.0);\n\n    info.r += smoothedAlpha * strength;\n\n    gl_FragColor = info;\n}"),this.updateProgram=createProgram(BaseWebGlProgram,this.gl,e,"precision highp float;\n\nuniform sampler2D texture;\nuniform vec2 delta;\n\nvarying vec2 coord;\n\nvoid main() {\n    vec4 info = texture2D(texture, coord);\n\n    vec2 dx = vec2(delta.x, 0.0);\n    vec2 dy = vec2(0.0, delta.y);\n\n    float average = (\n        texture2D(texture, coord - dx).r +\n        texture2D(texture, coord - dy).r +\n        texture2D(texture, coord + dx).r +\n        texture2D(texture, coord + dy).r\n    ) * 0.25;\n\n    info.g += average - info.r;\n    info.g *= 0.998;\n    info.r += info.g;\n\n    gl_FragColor = info;\n}"),this.gl.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=createProgram(RenderWebGlProgram,this.gl,"precision highp float;\n\nattribute vec2 vertex;\n\nuniform vec2 topLeft;\nuniform vec2 bottomRight;\nuniform vec2 containerRatio;\nuniform float scroll;\n\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\n\nvoid main() {\n    backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);\n    backgroundCoord.y += scroll;\n    ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;\n    gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);\n}","precision highp float;\n\nuniform sampler2D samplerBackground;\nuniform sampler2D samplerRipples;\nuniform vec2 delta;\nuniform float perturbance;\n\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\n\nvoid main() {\n    float height = texture2D(samplerRipples, ripplesCoord).r;\n    float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;\n    float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;\n    vec3 dx = vec3(delta.x, heightX - height, 0.0);\n    vec3 dy = vec3(0.0, heightY - height, delta.y);\n    vec2 offset = -normalize(cross(dy, dx)).xz;\n    float specularPow = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 2.0);\n    float specular = smoothstep(0.1, 0.2, specularPow);\n\n    float specMult = specular * 0.1 + 1.0;\n    vec4 backgroundColour = texture2D(samplerBackground, backgroundCoord + offset * perturbance);\n    gl_FragColor = backgroundColour * vec4(specMult, specMult, specMult, 1.0);\n    if (backgroundColour.r < 0.5)\n    {\n        vec4 specularColour = vec4(0.03 * specular, 0.04 * specular, 0.06 * specular, 1.0);\n        gl_FragColor += specularColour;\n    }\n}"),this.gl.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)}initTexture(){this.backgroundTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR)}setTransparentTexture(){this.transparentPixels&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.transparentPixels))}computeTextureBoundaries(){if(!this.renderProgram)return;const e=Math.max(this.canvas.width,this.canvas.height),r=e/this.backgroundSize,t=this.scrollElement?this.scrollElement.scrollTop:0;this.renderProgram.topLeft[0]=0,this.renderProgram.topLeft[1]=0,this.renderProgram.bottomRight[0]=this.canvas.width/e*r,this.renderProgram.bottomRight[1]=this.canvas.height/e*r,this.renderProgram.containerRatio[0]=this.canvas.width/e,this.renderProgram.containerRatio[1]=this.canvas.height/e,this.renderProgram.scroll=t/e*r}update(){this.updateProgram&&(this.gl.viewport(0,0,this.resolution,this.resolution),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),this.bindTexture(this.textures[this.bufferReadIndex]),this.gl.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices())}swapBufferIndices(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex}bindTexture(e,r){this.gl.activeTexture(this.gl.TEXTURE0+(r||0)),this.gl.bindTexture(this.gl.TEXTURE_2D,e)}drawQuad(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4)}render(){if(!this.renderProgram)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.canvas.width,this.canvas.height),e.enable(e.BLEND),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(this.renderProgram.id),this.backgroundTexture&&this.bindTexture(this.backgroundTexture,0),this.bindTexture(this.textures[0],1),e.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),e.uniform1f(this.renderProgram.locations.scroll,this.renderProgram.scroll),e.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.topLeft),e.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.bottomRight),e.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.containerRatio),e.uniform1i(this.renderProgram.locations.samplerBackground,0),e.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),e.disable(e.BLEND)}}if("function"==typeof document.querySelectorAll){const e=document.querySelectorAll("img");for(let r=0;r<e.length;r++){var img=e[r];img.hasAttribute("title")||img.setAttribute("title",img.getAttribute("alt"))}const r=document.querySelectorAll(".background"),t=60*-Math.random()+"s";for(let e=0;e<r.length;e++)r[e].style.animationDelay=t}const canvas=document.getElementById("ripplesCanvas");if(null!=canvas){new Ripples(canvas,512)}</script>
